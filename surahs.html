<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quran Surah & Ayah Viewer</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="images/man.png" type="image/png" />
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 700px;
      margin: 30px auto;
      padding: 0 15px 40px;
      background: #f9f9f9;
      color: #222;
      line-height: 1.6;
      user-select: none;
      transition: background 0.4s, color 0.4s;
    }
    body.dark {
      background: #1a1a1a;
      color: #eee;
    }
    h1 {
      text-align: center;
      margin-bottom: 25px;
      font-weight: 700;
      color: #2c3e50;
    }
    body.dark h1, body.dark h2 {
      color: #fff;
    }
    h2 {
      color: #34495e;
      margin-bottom: 15px;
      font-weight: 600;
      border-bottom: 2px solid #2980b9;
      padding-bottom: 8px;
    }
    #navButtons {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    #backBtn, #exitBtn {
      display: none;
      padding: 8px 14px;
      font-weight: 600;
      border-radius: 6px;
      width: fit-content;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    #backBtn { background: #e74c3c; color: #fff; }
    #backBtn:hover { background: #c0392b; }
    #exitBtn { background: #7f8c8d; color: #fff; }
    #exitBtn:hover { background: #606d71; }

    ul.surah-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
    }
    ul.surah-list li {
      background: #fff;
      border-radius: 8px;
      padding: 14px 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: box-shadow 0.3s ease, transform 0.2s ease;
    }
    body.dark ul.surah-list li {
      background: #2b2b2b;
    }
    ul.surah-list li:hover {
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
      transform: translateY(-3px);
    }
    ul.surah-list li a {
      text-decoration: none;
      color: #2980b9;
      font-weight: 600;
      display: block;
      font-size: 1rem;
    }
    ul.ayah-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    ul.ayah-list li {
      background: #fff;
      border-radius: 8px;
      margin-bottom: 14px;
      padding: 14px 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    body.dark ul.ayah-list li {
      background: #2b2b2b;
    }
    ul.ayah-list li strong {
      color: #2c3e50;
    }
    ul.ayah-list li audio {
      margin-top: 10px;
      width: 100%;
    }
    ul.ayah-list li button {
      margin-top: 8px;
      padding: 6px 12px;
      background: #25d366;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #content p {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      font-size: 1.15rem;
      color: #34495e;
    }
    body.dark #content p {
      background: #2b2b2b;
      color: #eee;
    }
    @media (max-width: 480px) {
      body { padding: 0 10px 30px; }
      ul.surah-list { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <h1>Quran Surah & Ayah Viewer</h1>
  <div id="navButtons">
    <div id="backBtn">&larr; Back</div>
    <div id="exitBtn">Exit</div>
  </div>
  <audio id="bismillah" src="https://cdn.islamic.network/audio/bismillah.mp3" preload="auto"></audio>
  <div id="content"><p>Loading...</p></div>

  <script>
    const apiBase = 'https://api.alquran.cloud/v1';
    const contentDiv = document.getElementById('content');
    const backBtn = document.getElementById('backBtn');
    const exitBtn = document.getElementById('exitBtn');

    function showNavButtons(show) {
      backBtn.style.display = show ? 'block' : 'none';
      exitBtn.style.display = show ? 'block' : 'none';
    }

    function loadSurahList() {
      showNavButtons(false);
      contentDiv.innerHTML = '<p>Loading Surahs...</p>';
      fetch(`${apiBase}/surah`)
        .then(res => res.json())
        .then(data => {
          const surahs = data.data;
          let html = '<h2>Select a Surah</h2><ul class="surah-list">';
          surahs.forEach(surah => {
            html += `<li><a href="#surah-${surah.number}">${surah.number}. ${surah.englishName} (${surah.name})</a></li>`;
          });
          html += '</ul>';
          contentDiv.innerHTML = html;
        });
    }

    function loadSurah(num) {
      showNavButtons(true);
      document.getElementById('bismillah').play().catch(() => {});
      contentDiv.innerHTML = `<p>Loading Surah ${num}...</p>`;
      Promise.all([
        fetch(`${apiBase}/surah/${num}/ar.alafasy`).then(res => res.json()),
        fetch(`https://api.quran.com:443/v4/quran/translations/131?chapter_number=${num}`)
          .then(res => res.json())
          .catch(() => ({ data: [] }))
      ]).then(([arabic, malay]) => {
        const surah = arabic.data;
        const malayData = malay.data;
        let html = `<h2>${surah.englishName} (${surah.name})</h2><ul class="ayah-list">`;
        surah.ayahs.forEach((ayah, idx) => {
          const malayText = malayData[idx]?.text || '‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç ‡¥µ‡¥ø‡¥µ‡µº‡¥§‡µç‡¥§‡¥®‡¥Ç ‡¥≤‡¥≠‡µç‡¥Ø‡¥Æ‡¥≤‡µç‡¥≤.';
          html += `<li>
            <strong>Ayah ${ayah.numberInSurah}</strong>
            <p>${ayah.text}</p>
            <p><em>Malayalam:</em> ${malayText}</p>
            <audio controls src="${ayah.audio}"></audio>
            <button onclick="shareAyah('${ayah.text.replace(/'/g, "\\'")}')">üì§ Share on WhatsApp</button>
          </li>`;
        });
        html += '</ul>';
        contentDiv.innerHTML = html;
      });
    }

    function shareAyah(text) {
      const msg = encodeURIComponent(text + "\n\nüìñ Quran Viewer");
      const url = `https://wa.me/?text=${msg}`;
      window.open(url, '_blank');
    }

    function loadAyah(surah, ayah) {
      showNavButtons(true);
      contentDiv.innerHTML = `<p>Loading Ayah ${ayah}...</p>`;
      fetch(`${apiBase}/ayah/${surah}:${ayah}/ar.alafasy`)
        .then(res => res.json())
        .then(data => {
          const a = data.data;
          contentDiv.innerHTML = `
            <h2>Surah ${a.surah.englishName} (${a.surah.name})</h2>
            <p><strong>Ayah ${a.numberInSurah}:</strong> ${a.text}</p>
            <audio controls src="${a.audio}"></audio>
            <button onclick="shareAyah('${a.text.replace(/'/g, "\\'")}')">üì§ Share on WhatsApp</button>
          `;
        });
    }

    backBtn.onclick = () => {
      if(location.hash.startsWith('#surah-') && location.hash.split('-').length === 2) {
        location.hash = '';
      } else if(location.hash.startsWith('#surah-') && location.hash.split('-').length === 4) {
        const surahNumber = location.hash.split('-')[1];
        location.hash = `#surah-${surahNumber}`;
      } else {
        location.hash = '';
      }
    };

    exitBtn.onclick = () => {
      window.location.href = 'index.html';
    };

    function router() {
      const hash = location.hash;
      if (!hash) loadSurahList();
      else if (/^#surah-\d+$/.test(hash)) {
        loadSurah(hash.split('-')[1]);
      } else if (/^#surah-\d+-ayah-\d+$/.test(hash)) {
        const parts = hash.split('-');
        loadAyah(parts[1], parts[3]);
      } else {
        contentDiv.innerHTML = 'Invalid URL';
      }
    }

    window.addEventListener('hashchange', router);
    router();

    // Dark mode detection
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.body.classList.add('dark');
    }

    // PWA Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
</body>
</html>

  
